<!DOCTYPE html>
<html>
<head>
    <link rel="SHORTCUT ICON" href="http://twmht.github.io/blog/favicon.ico">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="author" content="twmht" />
    <meta name="robots" content="index, follow"/>

    <meta property="og:title" content="Template Method Pattern -- 實際處理交給子類別"/>
    <meta property="og:url" content="http://twmht.github.io/blog/posts/2014/06/design-pattern/templateMethod.html"/>
    <meta property="og:site_name" content="技術筆記"/>
    <meta property="og:type" content="article"/>

    <link rel="canonical" href="http://twmht.github.io/blog/posts/2014/06/design-pattern/templateMethod.html" />

    <title>Template Method Pattern -- 實際處理交給子類別 | 技術筆記</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" />
    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" />

    <link rel="stylesheet" type="text/css" href="http://twmht.github.io/blog/theme/css/main.css" />
    <link href="http://twmht.github.io/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="技術筆記 Atom Feed" />

    <script type="text/javascript">var switchTo5x=true;</script>
    <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
    <script type="text/javascript">
        stLight.options({
            publisher: "",
            doNotHash: false,
            doNotCopy: false,
            hashAddressBar: false
        });
    </script>
</head>

<body id="index">
    <div class="row-fluid">
        <div class="span10 offset1">
            <header id="banner" >
                <h1>
                    <a href="http://twmht.github.io/blog/">技術筆記 </a>
                </h1>
                <nav class="navbar">
                    <div class="navbar-inner">
                        <ul class="nav">
                            <li ><a href="http://twmht.github.io/blog/category/acm.html">ACM</a></li>
                            <li ><a href="http://twmht.github.io/blog/category/android.html">android</a></li>
                            <li ><a href="http://twmht.github.io/blog/category/cc.html">C/C++</a></li>
                            <li class="active"><a href="http://twmht.github.io/blog/category/design-pattern.html">Design Pattern</a></li>
                            <li ><a href="http://twmht.github.io/blog/category/linux.html">linux</a></li>
                            <li ><a href="http://twmht.github.io/blog/category/multithread.html">Multithread</a></li>
                            <li ><a href="http://twmht.github.io/blog/category/others.html">Others</a></li>
                            <li ><a href="http://twmht.github.io/blog/category/python.html">Python</a></li>
                        </ul>

<script>
  (function() {
    var cx = '011100128719699788018:4mb0t5kqbse';
    var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
  })();
</script>
<div id="google-custom-search" class="nav">
    <gcse:search></gcse:search>
</div>
                    </div>
                </nav>
            </header><!-- /#banner -->
        </div>
    </div>

    <div class="row-fluid">
        <div class="span10 offset1">
            <div class="row-fluid">
<div class="span10 offset1">
  <section>
    <article>
      <header>
        <h1 class="entry-title">
          <a href="http://twmht.github.io/blog/posts/2014/06/design-pattern/templateMethod.html" rel="bookmark"
             title="Permalink to Template Method Pattern -- 實際處理交給子類別">Template Method Pattern -- 實際處理交給子類別</a></h1>
      </header>
      <div class="entry-content">
<footer class="post-info">
    <address class="vcard author">
        by <a class="url fn" href="http://twmht.github.io/blog/author/twmht.html">twmht</a>
    </address>

    in <a href="http://twmht.github.io/blog/category/design-pattern.html">Design Pattern</a>

    on 2014-06-29




    
</footer><!-- /.post-info -->

        <h3>用的時間點</h3>
<p>就像在塑膠版上挖空，然後用色筆塗滿挖空的部份，所表現出來的是固定的字型，但顏色卻因所使用的色筆顏色而異。所挖空的部份我們稱為 Template。</p>
<h3>如何設計</h3>
<p>將作為 Template 的方法定義在父類別，而方法的定義中則使用到抽象方法。因此如果只看父類別部份的程式，根本不知道到底結果會是怎樣的處理內容，最多只能了解該如何呼叫抽象方法而已。</p>
<p>實際實作抽象方法的是子類別。要在子類別實作方法，才能決定具體的處理動作。理論上，如果在不同的子類別執行不同的實作，應該就能發展出不同的處理內容。不過，無論在哪個子類別執行任何一種實作，處理的大致流程都還是要依照父類別所制定的方法。</p>
<p>像這樣在<strong>在父類別指定大綱並且在子類別規定具體內容</strong>，就稱為 Template Method Pattern。</p>
<h3>程式範例</h3>
<p>輸出字串，同樣流程的display，卻有不同的輸出方式(字串或字元)。</p>
<script src="https://gist.github.com/twmht/b29a5df581fcd2090243.js"></script>

<h4>AbstractClass (抽象類別) 參與者</h4>
<p>AbstractClass 實作範本方法，還有宣告 Template Method 所使用的抽象方法。這個抽象方法則由子類別 ConcreteClass 負責實作。例如 AbstractClass 類別。</p>
<h4>ConcreteClass (具象類別) 參與者</h4>
<p>具體實作 AbstractClass 所定義的抽象方法，這裡所實作的方法是從 AbstractClass 的範本方法(display 方法)呼叫出來。例如 CharDisplay 和 StringDisplay 類別。</p>
<h3>實際例子</h3>
<p>在java.io.InputStream 的子類別進行實作的方法是 java.io.InputStream 的 read() 方法。read() 方法則被 java.io.InputStream 的範本方法 read(byte[] b,int off,int len) 反覆呼叫出來。</p>
<p>換句話說，<strong>讀取1 byte</strong> 這個處理的具體內容是交給子類別，在java.io.InputStream 這端則產生 <strong>將指定 byte 讀入到陣列的指定位置</strong>之處理的範本方法。</p>
<p><strong>Template Method Pattern</strong>不容許使用介面，因為介面是全部方法都是抽象，而抽象類別允許部份方法抽象。</p>
<h3>優點</h3>
<h4>邏輯可共用</h4>
<p>因為在父類別的範本方法已經敘述了演算法則，所以子類別這邊就不需要重新逐一敘述演算法則。</p>
<p>假設現在故意不用 Template Method Pattern，只利用編輯器的剪貼功能來建立多個 ConcreteClass 參與者。可是後來發現其中一個 ConcreteClass 有一個 bug 時，只修改一個 bug 並沒有辦法反應到所有的 ConcreteClass 上。</p>
<p>從這個角度來看，如果利用 Template Method Pattern 來寫程式的話，當你發現範本方法裡面有錯誤時，只要修改這個範本方法即可。</p>
<h4>父類別跟子類別的連續動作</h4>
<p>在 Template Method Pattern 中，父類別跟子類別之間的聯絡互動相當緊密。因此如果要在子類別實際實作一個已經在父類別宣告過的抽象方法時，必須先了解應該在哪個時間點呼叫這個抽象方法。要是沒有父類別的原始程式碼，恐怕子類別的實作會是一個高難度的跳戰。</p>
<h4>子類別應視同父類別</h4>
<p>例如 CharDisplay 的物件個體和 StringDisplay 的物件個體都先指定到 AbstractClass 型態的變數，然後才呼叫 display 範本方法。</p>
<p>假設現在有一個父類別型態的變數，子類別的物件個體也被指定到該變數。此時，程式最好利用 instanceof 等寫成無論子類別種類為何，程式都能正常運作。</p>
<p>無論父類別型態的變數指定哪一個子類別的物件個體都能正常動作的原則稱為 <strong>The Liskov Substituion Principle</strong>，LSP 是繼承相關的一般性原則。</p>
<h3>類別階層與抽象類別</h3>
<h4>父類別對子類別的要求</h4>
<p>我們在學習類別階層時，通常都是從子類別的角度來思考:</p>
<ul>
<li>在子類別可利用父類別中所定義的方法</li>
<li>子類別只要寫一點點方法就可以新增其他功能</li>
<li>在子類別 override 方法就能修改程式動作</li>
</ul>
<p>在這裡可以改變一下觀點，從父類別的角度來想。假設現在父類別已經宣告了抽象方法。此時，這個方法的實作要<strong>全權交給子類別</strong>。也就是說，當你在宣告抽象方法時，事實上是在程式中表示：</p>
<ul>
<li>期待子類別會實作這個方法</li>
<li>要求子類別要實作這個方法</li>
</ul>
<p>你也可以把它解釋成子類別產生一個需要實作在父類別所宣告的抽象方法的責任。這稱為 subclass responsibility。</p>
<h4>抽象類別的意義</h4>
<p>因為抽象方法裡面沒有方法的主體，所以無法得知具體的處理內容。但是，它可以決定方法名稱並且利用範本方法來敘述處理的內容。實際的處理內容當然要留給子類別確定，<strong>不過在抽象類別的階段就先抓出處理流程的型態也很重要</strong>。</p>
<h4>父類別跟子類別之間的協調</h4>
<p>在設計一個程式時，必須不斷協調父類別和子類別兩邊。如果增加父類別這邊的敘述，就可以減輕在子類別的負擔，但是相對地也會降低子類別自由發揮的空間。反過來，如果減少父類別的敘述時，子類別這邊的敘述就會比較棘手，可能會發生不同子類別出現同樣處理的敘述內容。</p>
<p>Template Method Pattern 則是在父類別敘述處理的骨架，把具體的外觀肉體留給子類別來做。至於應該怎麼分配，則是程式設計師的工作了。</p>

      </div><!-- /.entry-content -->

    </article>
  </section>
</div>
            </div>
        </div>
    </div>

    <footer id="site-footer">
        <div class="row-fluid">
            <div class="span10 offset1">
                <address>
                    <p>
                        This blog is proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                    </p>
                    <p>
                        <a href="http://github.com/jsliang/pelican-fresh/">Fresh</a> is a responsive theme designed by <a href="http://jsliang.com/">jsliang</a> and <a href="https://github.com/jsliang/pelican-fresh/graphs/contributors">contributors</a>.
                        Special thanks to <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a> and <a href="http://getbootstrap.com/">Twitter Bootstrap</a>.
                    </p>
                </address>
            </div>
        </div>
    </footer>

    <script src="//code.jquery.com/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>
</body>
</html>